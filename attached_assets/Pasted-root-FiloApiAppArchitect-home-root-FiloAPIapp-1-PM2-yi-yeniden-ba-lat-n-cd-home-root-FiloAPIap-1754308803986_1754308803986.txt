root@FiloApiAppArchitect:/home/root/FiloAPIapp# # 1. PM2'yi yeniden başlatın
cd /home/root/FiloAPIapp
pm2 delete all
pm2 start ecosystem.config.cjs

# 2. Durumu kontrol edin
pm2 status
pm2 logs --lines 20
[PM2] Applying action deleteProcessId on app [all](ids: [ 0 ])
[PM2] [filoki-api](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2][WARN] Applications filoki-api not running, starting...
[PM2] App [filoki-api] launched (1 instances)
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ filoki-api         │ cluster  │ 0    │ online    │ 0%       │ 39.9mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ filoki-api         │ cluster  │ 0    │ online    │ 0%       │ 60.8mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 20 lines for [all] processes (change the value with --lines option)
/root/.pm2/pm2.log last 20 lines:
PM2        | 2025-08-04T08:55:51: PM2 log: Current arch         : x64
PM2        | 2025-08-04T08:55:51: PM2 log: PM2 home             : /root/.pm2
PM2        | 2025-08-04T08:55:51: PM2 log: PM2 PID file         : /root/.pm2/pm2.pid
PM2        | 2025-08-04T08:55:51: PM2 log: RPC socket file      : /root/.pm2/rpc.sock
PM2        | 2025-08-04T08:55:51: PM2 log: BUS socket file      : /root/.pm2/pub.sock
PM2        | 2025-08-04T08:55:51: PM2 log: Application log path : /root/.pm2/logs
PM2        | 2025-08-04T08:55:51: PM2 log: Worker Interval      : 30000
PM2        | 2025-08-04T08:55:51: PM2 log: Process dump file    : /root/.pm2/dump.pm2
PM2        | 2025-08-04T08:55:51: PM2 log: Concurrent actions   : 2
PM2        | 2025-08-04T08:55:51: PM2 log: SIGTERM timeout      : 1600
PM2        | 2025-08-04T08:55:51: PM2 log: Runtime Binary       : /usr/bin/node
PM2        | 2025-08-04T08:55:51: PM2 log: ===============================================================================
PM2        | 2025-08-04T11:01:38: PM2 log: App [filoki-api:0] starting in -cluster mode-
PM2        | 2025-08-04T11:01:38: PM2 log: App [filoki-api:0] online
PM2        | 2025-08-04T11:03:55: PM2 log: Stopping app:filoki-api id:0
PM2        | 2025-08-04T11:03:55: PM2 log: App name:filoki-api id:0 disconnected
PM2        | 2025-08-04T11:03:55: PM2 log: App [filoki-api:0] exited with code [0] via signal [SIGINT]
PM2        | 2025-08-04T11:03:55: PM2 log: pid=14196 msg=process killed
PM2        | 2025-08-04T11:03:56: PM2 log: App [filoki-api:0] starting in -cluster mode-
PM2        | 2025-08-04T11:03:56: PM2 log: App [filoki-api:0] online

/home/root/FiloAPIapp/logs/out-0.log last 20 lines:
/home/root/FiloAPIapp/logs/error-0.log last 20 lines:
0|filoki-a | You have triggered an unhandledRejection, you may have forgotten to catch a Promise rejection:
0|filoki-a | Error: DATABASE_URL must be set. Did you forget to provision a database?
0|filoki-a |     at server/db.ts (file:///home/root/FiloAPIapp/dist/index.js:1358:13)
0|filoki-a |     at __init (file:///home/root/FiloAPIapp/dist/index.js:4:56)
0|filoki-a |     at file:///home/root/FiloAPIapp/dist/index.js:3572:1
0|filoki-a |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
0|filoki-a |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)

0|filoki-api  | You have triggered an unhandledRejection, you may have forgotten to catch a Promise rejection:
0|filoki-api  | Error: DATABASE_URL must be set. Did you forget to provision a database?
0|filoki-api  |     at server/db.ts (file:///home/root/FiloAPIapp/dist/index.js:1358:13)
0|filoki-api  |     at __init (file:///home/root/FiloAPIapp/dist/index.js:4:56)
0|filoki-api  |     at file:///home/root/FiloAPIapp/dist/index.js:3572:1
0|filoki-api  |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
0|filoki-api  |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
^[^C
root@FiloApiAppArchitect:/home/root/FiloAPIapp# # Local test
curl http://localhost:5000/api/health

# Domain üzerinden test (eğer DNS yönlendirmesi tamamsa)
curl https://filokiapi.architectaiagency.com/api/health
curl: (7) Failed to connect to localhost port 5000 after 0 ms: Could not connect to server
root@FiloApiAppArchitect:/home/root/FiloAPIapp# curl http://localhost:5000/api/health5000/api/health
curl: (7) Failed to connect to localhost port 5000 after 0 ms: Could not connect to server
root@FiloApiAppArchitect:/home/root/FiloAPIapp# # Script'i çalıştırın
chmod +x fix-pm2-env.sh
./fix-pm2-env.sh
chmod: cannot access 'fix-pm2-env.sh': No such file or directory
-bash: ./fix-pm2-env.sh: No such file or directory
root@FiloApiAppArchitect:/home/root/FiloAPIapp# cat .env | grep DATABASE_URL
DATABASE_URL=postgresql://postgres:Acar@localhost:5432/filoki_db
root@FiloApiAppArchitect:/home/root/FiloAPIapp# set -a
root@FiloApiAppArchitect:/home/root/FiloAPIapp# source .env
root@FiloApiAppArchitect:/home/root/FiloAPIapp# set +a
root@FiloApiAppArchitect:/home/root/FiloAPIapp# node dist/index.js 
11:10:35 AM [express] serving on port 5000
^C
root@FiloApiAppArchitect:/home/root/FiloAPIapp# # Önce PM2'yi temizleyin
pm2 delete all

# .env dosyası ile başlatın
cd /home/root/FiloAPIapp
pm2 start dist/index.js --name filoki-api --env-file .env
[PM2] Applying action deleteProcessId on app [all](ids: [ 0 ])
[PM2] [filoki-api](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘

  error: unknown option `--env-file'

root@FiloApiAppArchitect:/home/root/FiloAPIapp# pm2 status
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
root@FiloApiAppArchitect:/home/root/FiloAPIapp# nano ecosystem.config.js
root@FiloApiAppArchitect:/home/root/FiloAPIapp# pm2 delete all
[PM2][WARN] No process found
root@FiloApiAppArchitect:/home/root/FiloAPIapp# pm2 start ecosystem.config.js
[PM2][ERROR] File ecosystem.config.js malformated
ReferenceError: module is not defined
    at file:///home/root/FiloAPIapp/ecosystem.config.js:1:1
    at ModuleJobSync.runSync (node:internal/modules/esm/module_job:387:35)
    at ModuleLoader.importSyncForRequire (node:internal/modules/esm/loader:323:47)
    at loadESMFromCJS (node:internal/modules/cjs/loader:1371:24)
    at Module._compile (node:internal/modules/cjs/loader:1511:5)
    at Module._extensions..js (node:internal/modules/cjs/loader:1572:16)
    at Module.load (node:internal/modules/cjs/loader:1275:32)
    at Module._load (node:internal/modules/cjs/loader:1096:12)
    at Module.require (node:internal/modules/cjs/loader:1298:19)
    at require (node:internal/modules/helpers:182:18)
root@FiloApiAppArchitect:/home/root/FiloAPIapp# pm2 start dist/index.js --name filoki-api --node-args="-r dotenv/config"
[PM2] Starting /home/root/FiloAPIapp/dist/index.js in fork_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ filoki-api         │ fork     │ 0    │ online    │ 0%       │ 18.9mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
root@FiloApiAppArchitect:/home/root/FiloAPIapp# # PM2'yi temizle
pm2 delete all

# Çalışan komutu PM2'ye ver
pm2 start --name filoki-api bash -- -c "cd /home/root/FiloAPIapp && set -a && source .env && set +a && exec node dist/index.js"

# Kaydet
pm2 save
pm2 startup
[PM2] Applying action deleteProcessId on app [all](ids: [ 0 ])
[PM2] [all](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Starting /usr/bin/bash in fork_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ filoki-api         │ fork     │ 0    │ online    │ 0%       │ 13.4mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2
[PM2] Init System found: systemd
Platform systemd
Template
[Unit]
Description=PM2 process manager
Documentation=https://pm2.keymetrics.io/
After=network.target

[Service]
Type=forking
User=root
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity
Environment=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
Environment=PM2_HOME=/root/.pm2
PIDFile=/root/.pm2/pm2.pid
Restart=on-failure

ExecStart=/usr/lib/node_modules/pm2/bin/pm2 resurrect
ExecReload=/usr/lib/node_modules/pm2/bin/pm2 reload all
ExecStop=/usr/lib/node_modules/pm2/bin/pm2 kill

[Install]
WantedBy=multi-user.target

Target path
/etc/systemd/system/pm2-root.service
Command list
[ 'systemctl enable pm2-root' ]
[PM2] Writing init configuration in /etc/systemd/system/pm2-root.service
[PM2] Making script booting at startup...
[PM2] [-] Executing: systemctl enable pm2-root...
[PM2] [v] Command successfully executed.
+---------------------------------------+
[PM2] Freeze a process list on reboot via:
$ pm2 save

[PM2] Remove init script via:
$ pm2 unstartup systemd
root@FiloApiAppArchitect:/home/root/FiloAPIapp# # API testi
curl http://localhost:5000/api/health

# Port kontrolü
netstat -tlnp | grep :5000
{"success":true,"status":"healthy","timestamp":"2025-08-04T11:22:17.095Z","version":"3.0.0","services":{"database":"connected","authentication":"active","swagger":"available"}}tcp        0      0 0.0.0.0:5000            0.0.0.0:*               LISTEN      14679/node          
root@FiloApiAppArchitect:/home/root/FiloAPIapp# Read from remote host 161.35.1.46: Connection reset by peer
Connection to 161.35.1.46 closed.
client_loop: send disconnect: Broken pipe
acar@192 ~ % ssh -i /Users/acar/.ssh/id_ed25519 root@161.35.1.46
root@161.35.1.46's password: 
Welcome to Ubuntu 25.04 (GNU/Linux 6.14.0-27-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Mon Aug  4 11:44:17 UTC 2025

  System load:  0.0                Processes:             138
  Usage of /:   3.5% of 115.25GB   Users logged in:       1
  Memory usage: 13%                IPv4 address for eth0: 161.35.1.46
  Swap usage:   0%                 IPv4 address for eth0: 10.10.0.6

0 updates can be applied immediately.


root@FiloApiAppArchitect:~# curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"alper.acar@architectaiagency.com","password":"Acar"}'
{"success":false,"error":"LOGIN_ERROR","message":"Sunucu hatası - giriş işlemi başarısız"}root@FiloApiAppArch# Son hata loglarını görünını görün
pm2 logs filoki-api --lines 50

# Sadece error loglarını görün
pm2 logs filoki-api --err --lines 50
[TAILING] Tailing last 50 lines for [filoki-api] process (change the value with --lines option)
/root/.pm2/logs/filoki-api-error.log last 50 lines:
0|filoki-a |     _errorEmitted: true,
0|filoki-a |     _extensions: {},
0|filoki-a |     _paused: false,
0|filoki-a |     _protocol: '',
0|filoki-a |     _readyState: 3,
0|filoki-a |     _receiver: null,
0|filoki-a |     _sender: null,
0|filoki-a |     _socket: null,
0|filoki-a |     _bufferedAmount: 0,
0|filoki-a |     _isServer: false,
0|filoki-a |     _redirects: 0,
0|filoki-a |     _autoPong: true,
0|filoki-a |     _url: 'wss://localhost/v2',
0|filoki-a |     _req: null,
0|filoki-a |     [Symbol(shapeMode)]: false,
0|filoki-a |     [Symbol(kCapture)]: false
0|filoki-a |   },
0|filoki-a |   [Symbol(kType)]: 'error',
0|filoki-a |   [Symbol(kError)]: Error [ERR_TLS_CERT_ALTNAME_INVALID]: Hostname/IP does not match certificate's altnames: Host: localhost. is not in the cert's altnames: DNS:filokiapi.architectaiagency.com
0|filoki-a |       at Object.checkServerIdentity (node:tls:316:12)
0|filoki-a |       at TLSSocket.onConnectSecure (node:_tls_wrap:1687:27)
0|filoki-a |       at TLSSocket.emit (node:events:524:28)
0|filoki-a |       at TLSSocket._finishInit (node:_tls_wrap:1076:8)
0|filoki-a |       at ssl.onhandshakedone (node:_tls_wrap:862:12) {
0|filoki-a |     code: 'ERR_TLS_CERT_ALTNAME_INVALID',
0|filoki-a |     reason: "Host: localhost. is not in the cert's altnames: DNS:filokiapi.architectaiagency.com",
0|filoki-a |     host: 'localhost',
0|filoki-a |     cert: {
0|filoki-a |       subject: [Object: null prototype],
0|filoki-a |       issuer: [Object: null prototype],
0|filoki-a |       subjectaltname: 'DNS:filokiapi.architectaiagency.com',
0|filoki-a |       infoAccess: [Object: null prototype],
0|filoki-a |       ca: false,
0|filoki-a |       bits: 256,
0|filoki-a |       pubkey: <Buffer 04 6c 2a fa 2f e8 e5 52 0d 38 37 4c 40 82 9f 32 c4 49 77 c9 88 bf 03 91 0e 1b a8 c1 d0 b9 dd a6 31 f2 3f b6 34 3e 62 0f 27 3a 72 04 29 19 15 61 f9 41 ... 15 more bytes>,
0|filoki-a |       asn1Curve: 'prime256v1',
0|filoki-a |       nistCurve: 'P-256',
0|filoki-a |       valid_from: 'Aug  4 07:58:57 2025 GMT',
0|filoki-a |       valid_to: 'Nov  2 07:58:56 2025 GMT',
0|filoki-a |       fingerprint: '37:87:04:83:E1:46:BB:D4:F3:4E:26:6E:BC:AC:F4:32:4E:0C:3F:DE',
0|filoki-a |       fingerprint256: 'F5:89:08:0C:AD:EA:E4:C2:64:B2:36:99:9B:43:C1:7C:73:1D:54:F4:F7:B3:1B:1B:9C:2A:01:27:34:41:22:89',
0|filoki-a |       fingerprint512: 'B9:74:28:C6:BF:18:BF:47:C3:BC:93:D8:D6:93:99:0D:2D:1E:96:1C:94:20:A4:3E:BE:BA:17:A5:9C:7D:7A:A5:16:09:1D:52:45:19:A9:F8:C4:79:E7:4A:2B:ED:3B:3C:DC:99:CD:C1:ED:0D:0A:F5:C3:47:06:80:9E:67:8B:54',
0|filoki-a |       ext_key_usage: [Array],
0|filoki-a |       serialNumber: '06543EDF6DB5DA892D3194993D75CE94F87C',
0|filoki-a |       raw: <Buffer 30 82 03 ab 30 82 03 32 a0 03 02 01 02 02 12 06 54 3e df 6d b5 da 89 2d 31 94 99 3d 75 ce 94 f8 7c 30 0a 06 08 2a 86 48 ce 3d 04 03 03 30 32 31 0b 30 ... 893 more bytes>,
0|filoki-a |       issuerCertificate: [Object]
0|filoki-a |     }
0|filoki-a |   },
0|filoki-a |   [Symbol(kMessage)]: "Hostname/IP does not match certificate's altnames: Host: localhost. is not in the cert's altnames: DNS:filokiapi.architectaiagency.com"
0|filoki-a | }

/root/.pm2/logs/filoki-api-out.log last 50 lines:
0|filoki-a | 11:21:56 AM [express] serving on port 5000
0|filoki-a | 11:22:17 AM [express] GET /api/health 200 in 82ms :: {"success":true,"status":"healthy","timestamp":"…
0|filoki-a | 11:24:06 AM [express] POST /api/auth/login 500 in 125ms :: {"success":false,"error":"LOGIN_ERROR","me…
0|filoki-a | 11:24:21 AM [express] POST /api/auth/login 500 in 47ms :: {"success":false,"error":"LOGIN_ERROR","mes…
0|filoki-a | 11:28:05 AM [express] POST /api/auth/login 500 in 83ms :: {"success":false,"error":"LOGIN_ERROR","mes…
0|filoki-a | 11:42:24 AM [express] POST /api/auth/login 500 in 50ms :: {"success":false,"error":"LOGIN_ERROR","mes…
0|filoki-a | 11:44:23 AM [express] POST /api/auth/login 500 in 47ms :: {"success":false,"error":"LOGIN_ERROR","mes…

^C
[TAILING] Tailing last 50 lines for [filoki-api] process (change the value with --lines option)
/root/.pm2/logs/filoki-api-error.log last 50 lines:
0|filoki-a |     _errorEmitted: true,
0|filoki-a |     _extensions: {},
0|filoki-a |     _paused: false,
0|filoki-a |     _protocol: '',
0|filoki-a |     _readyState: 3,
0|filoki-a |     _receiver: null,
0|filoki-a |     _sender: null,
0|filoki-a |     _socket: null,
0|filoki-a |     _bufferedAmount: 0,
0|filoki-a |     _isServer: false,
0|filoki-a |     _redirects: 0,
0|filoki-a |     _autoPong: true,
0|filoki-a |     _url: 'wss://localhost/v2',
0|filoki-a |     _req: null,
0|filoki-a |     [Symbol(shapeMode)]: false,
0|filoki-a |     [Symbol(kCapture)]: false
0|filoki-a |   },
0|filoki-a |   [Symbol(kType)]: 'error',
0|filoki-a |   [Symbol(kError)]: Error [ERR_TLS_CERT_ALTNAME_INVALID]: Hostname/IP does not match certificate's altnames: Host: localhost. is not in the cert's altnames: DNS:filokiapi.architectaiagency.com
0|filoki-a |       at Object.checkServerIdentity (node:tls:316:12)
0|filoki-a |       at TLSSocket.onConnectSecure (node:_tls_wrap:1687:27)
0|filoki-a |       at TLSSocket.emit (node:events:524:28)
0|filoki-a |       at TLSSocket._finishInit (node:_tls_wrap:1076:8)
0|filoki-a |       at ssl.onhandshakedone (node:_tls_wrap:862:12) {
0|filoki-a |     code: 'ERR_TLS_CERT_ALTNAME_INVALID',
0|filoki-a |     reason: "Host: localhost. is not in the cert's altnames: DNS:filokiapi.architectaiagency.com",
0|filoki-a |     host: 'localhost',
0|filoki-a |     cert: {
0|filoki-a |       subject: [Object: null prototype],
0|filoki-a |       issuer: [Object: null prototype],
0|filoki-a |       subjectaltname: 'DNS:filokiapi.architectaiagency.com',
0|filoki-a |       infoAccess: [Object: null prototype],
0|filoki-a |       ca: false,
0|filoki-a |       bits: 256,
0|filoki-a |       pubkey: <Buffer 04 6c 2a fa 2f e8 e5 52 0d 38 37 4c 40 82 9f 32 c4 49 77 c9 88 bf 03 91 0e 1b a8 c1 d0 b9 dd a6 31 f2 3f b6 34 3e 62 0f 27 3a 72 04 29 19 15 61 f9 41 ... 15 more bytes>,
0|filoki-a |       asn1Curve: 'prime256v1',
0|filoki-a |       nistCurve: 'P-256',
0|filoki-a |       valid_from: 'Aug  4 07:58:57 2025 GMT',
0|filoki-a |       valid_to: 'Nov  2 07:58:56 2025 GMT',
0|filoki-a |       fingerprint: '37:87:04:83:E1:46:BB:D4:F3:4E:26:6E:BC:AC:F4:32:4E:0C:3F:DE',
0|filoki-a |       fingerprint256: 'F5:89:08:0C:AD:EA:E4:C2:64:B2:36:99:9B:43:C1:7C:73:1D:54:F4:F7:B3:1B:1B:9C:2A:01:27:34:41:22:89',
0|filoki-a |       fingerprint512: 'B9:74:28:C6:BF:18:BF:47:C3:BC:93:D8:D6:93:99:0D:2D:1E:96:1C:94:20:A4:3E:BE:BA:17:A5:9C:7D:7A:A5:16:09:1D:52:45:19:A9:F8:C4:79:E7:4A:2B:ED:3B:3C:DC:99:CD:C1:ED:0D:0A:F5:C3:47:06:80:9E:67:8B:54',
0|filoki-a |       ext_key_usage: [Array],
0|filoki-a |       serialNumber: '06543EDF6DB5DA892D3194993D75CE94F87C',
0|filoki-a |       raw: <Buffer 30 82 03 ab 30 82 03 32 a0 03 02 01 02 02 12 06 54 3e df 6d b5 da 89 2d 31 94 99 3d 75 ce 94 f8 7c 30 0a 06 08 2a 86 48 ce 3d 04 03 03 30 32 31 0b 30 ... 893 more bytes>,
0|filoki-a |       issuerCertificate: [Object]
0|filoki-a |     }
0|filoki-a |   },
0|filoki-a |   [Symbol(kMessage)]: "Hostname/IP does not match certificate's altnames: Host: localhost. is not in the cert's altnames: DNS:filokiapi.architectaiagency.com"
0|filoki-a | }

q
^[^C
root@FiloApiAppArchitect:~# # PostgreSQL'e bağlanın ve kullanıcıyı arayın
cd /home/root/FiloAPIapp
PGPASSWORD=$(grep DB_PASS .env | cut -d'=' -f2) psql -h localhost -U postgres -d filoki_db -c "SELECT id, email, name, role FROM users WHERE email='alper.acar@architectaiagency.com';"
Password for user postgres: 
ERROR:  column "name" does not exist
LINE 1: SELECT id, email, name, role FROM users WHERE email='alper.a...
                          ^
root@FiloApiAppArchitect:/home/root/FiloAPIapp# # PostgreSQL'e bağlanın ve kullanıcıyı arayın
cd /home/root/FiloAPIapp
PGPASSWORD=$(grep DB_PASS .env | cut -d'=' -f2) psql -h localhost -U postgres -d filoki_db -c "SELECT * FROM users WHERE email='alper.acar@architectaiagency.com';"
Password for user postgres: 
root@FiloApiAppArchitect:/home/root/FiloAPIapp# 
root@FiloApiAppArchitect:/home/root/FiloAPIapp# node -e "import('bcryptjs').then(b => b.hash('Acar', 10).then(console.log))"
$2b$10$6oHPtVQRi6bAxdtOipQNg.F9YGqt/1rbqp/qLGOl0Zlv/EVtXyJQy
root@FiloApiAppArchitect:/home/root/FiloAPIapp# source .env
PGPASSWORD="$DB_PASS" psql -h localhost -U postgres -d filoki_db -c "UPDATE users SET password_hash='$2b$10$6oHPtVQRi6bAxdtOipQNg.F9YGqt/1rbqp/qLGOl0Zlv/EVtXyJQy' WHERE email='alper.acar@architectaiagency.com';"
Password for user postgres: 
UPDATE 1
root@FiloApiAppArchitect:/home/root/FiloAPIapp# curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"alper.acar@architectaiagency.com","password":"Acar"}'
{"success":false,"error":"LOGIN_ERROR","message":"Sunucu hatası - giriş işlemi başarısız"}root@FiloApiAppArchitect:/home/root/FiloAPIapp# pm2 logs filoki-api --lines 50
[TAILING] Tailing last 50 lines for [filoki-api] process (change the value with --lines option)
/root/.pm2/logs/filoki-api-error.log last 50 lines:
0|filoki-a |     _errorEmitted: true,
0|filoki-a |     _extensions: {},
0|filoki-a |     _paused: false,
0|filoki-a |     _protocol: '',
0|filoki-a |     _readyState: 3,
0|filoki-a |     _receiver: null,
0|filoki-a |     _sender: null,
0|filoki-a |     _socket: null,
0|filoki-a |     _bufferedAmount: 0,
0|filoki-a |     _isServer: false,
0|filoki-a |     _redirects: 0,
0|filoki-a |     _autoPong: true,
0|filoki-a |     _url: 'wss://localhost/v2',
0|filoki-a |     _req: null,
0|filoki-a |     [Symbol(shapeMode)]: false,
0|filoki-a |     [Symbol(kCapture)]: false
0|filoki-a |   },
0|filoki-a |   [Symbol(kType)]: 'error',
0|filoki-a |   [Symbol(kError)]: Error [ERR_TLS_CERT_ALTNAME_INVALID]: Hostname/IP does not match certificate's altnames: Host: localhost. is not in the cert's altnames: DNS:filokiapi.architectaiagency.com
0|filoki-a |       at Object.checkServerIdentity (node:tls:316:12)
0|filoki-a |       at TLSSocket.onConnectSecure (node:_tls_wrap:1687:27)
0|filoki-a |       at TLSSocket.emit (node:events:524:28)
0|filoki-a |       at TLSSocket._finishInit (node:_tls_wrap:1076:8)
0|filoki-a |       at ssl.onhandshakedone (node:_tls_wrap:862:12) {
0|filoki-a |     code: 'ERR_TLS_CERT_ALTNAME_INVALID',
0|filoki-a |     reason: "Host: localhost. is not in the cert's altnames: DNS:filokiapi.architectaiagency.com",
0|filoki-a |     host: 'localhost',
0|filoki-a |     cert: {
0|filoki-a |       subject: [Object: null prototype],
0|filoki-a |       issuer: [Object: null prototype],
0|filoki-a |       subjectaltname: 'DNS:filokiapi.architectaiagency.com',
0|filoki-a |       infoAccess: [Object: null prototype],
0|filoki-a |       ca: false,
0|filoki-a |       bits: 256,
0|filoki-a |       pubkey: <Buffer 04 6c 2a fa 2f e8 e5 52 0d 38 37 4c 40 82 9f 32 c4 49 77 c9 88 bf 03 91 0e 1b a8 c1 d0 b9 dd a6 31 f2 3f b6 34 3e 62 0f 27 3a 72 04 29 19 15 61 f9 41 ... 15 more bytes>,
0|filoki-a |       asn1Curve: 'prime256v1',
0|filoki-a |       nistCurve: 'P-256',
0|filoki-a |       valid_from: 'Aug  4 07:58:57 2025 GMT',
0|filoki-a |       valid_to: 'Nov  2 07:58:56 2025 GMT',
0|filoki-a |       fingerprint: '37:87:04:83:E1:46:BB:D4:F3:4E:26:6E:BC:AC:F4:32:4E:0C:3F:DE',
0|filoki-a |       fingerprint256: 'F5:89:08:0C:AD:EA:E4:C2:64:B2:36:99:9B:43:C1:7C:73:1D:54:F4:F7:B3:1B:1B:9C:2A:01:27:34:41:22:89',
0|filoki-a |       fingerprint512: 'B9:74:28:C6:BF:18:BF:47:C3:BC:93:D8:D6:93:99:0D:2D:1E:96:1C:94:20:A4:3E:BE:BA:17:A5:9C:7D:7A:A5:16:09:1D:52:45:19:A9:F8:C4:79:E7:4A:2B:ED:3B:3C:DC:99:CD:C1:ED:0D:0A:F5:C3:47:06:80:9E:67:8B:54',
0|filoki-a |       ext_key_usage: [Array],
0|filoki-a |       serialNumber: '06543EDF6DB5DA892D3194993D75CE94F87C',
0|filoki-a |       raw: <Buffer 30 82 03 ab 30 82 03 32 a0 03 02 01 02 02 12 06 54 3e df 6d b5 da 89 2d 31 94 99 3d 75 ce 94 f8 7c 30 0a 06 08 2a 86 48 ce 3d 04 03 03 30 32 31 0b 30 ... 893 more bytes>,
0|filoki-a |       issuerCertificate: [Object]
0|filoki-a |     }
0|filoki-a |   },
0|filoki-a |   [Symbol(kMessage)]: "Hostname/IP does not match certificate's altnames: Host: localhost. is not in the cert's altnames: DNS:filokiapi.architectaiagency.com"
0|filoki-a | }

/root/.pm2/logs/filoki-api-out.log last 50 lines:
0|filoki-a | 11:21:56 AM [express] serving on port 5000
0|filoki-a | 11:22:17 AM [express] GET /api/health 200 in 82ms :: {"success":true,"status":"healthy","timestamp":"…
0|filoki-a | 11:24:06 AM [express] POST /api/auth/login 500 in 125ms :: {"success":false,"error":"LOGIN_ERROR","me…
0|filoki-a | 11:24:21 AM [express] POST /api/auth/login 500 in 47ms :: {"success":false,"error":"LOGIN_ERROR","mes…
0|filoki-a | 11:28:05 AM [express] POST /api/auth/login 500 in 83ms :: {"success":false,"error":"LOGIN_ERROR","mes…
0|filoki-a | 11:42:24 AM [express] POST /api/auth/login 500 in 50ms :: {"success":false,"error":"LOGIN_ERROR","mes…
0|filoki-a | 11:44:23 AM [express] POST /api/auth/login 500 in 47ms :: {"success":false,"error":"LOGIN_ERROR","mes…
0|filoki-a | 11:54:16 AM [express] POST /api/auth/login 500 in 48ms :: {"success":false,"error":"LOGIN_ERROR","mes…

^[^C
root@FiloApiAppArchitect:/home/root/FiloAPIapp# node -e "
import('bcryptjs').then(async (bcrypt) => {
  const hash = await bcrypt.hash('Acar', 10);
  console.log('UPDATE users SET password_hash=\'' + hash + '\' WHERE email=\'alper.acar@architectaiagency.com\';');
});" | source .env && PGPASSWORD="$DB_PASS" psql -h localhost -U postgres -d filoki_db
Password for user postgres: 
psql (17.5 (Ubuntu 17.5-0ubuntu0.25.04.1))
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, compression: off, ALPN: postgresql)
Type "help" for help.

filoki_db=# \l
filoki_db=# \dt
filoki_db=# Select * from users
filoki_db-# q
filoki_db-# su
filoki_db-# node -e "
import('bcryptjs').then(async (bcrypt) => {
  const hash = await bcrypt.hash('Acar', 10);
  console.log('UPDATE users SET password_hash=\'' + hash + '\' WHERE email=\'alper.acar@architectaiagency.com\';');
});" | source .env && PGPASSWORD="$DB_PASS" psql -h localhost -U postgres -d filoki_db
filoki_db-# UPDATE users SET password_hash='$2b$10$GXMjN.oKgS3vhKqGvLqYqe5Ys5.FjQqZ9YhXqY3FmHh9qKtYxYvFG' WHERE email='alper.acar@architectaiagency.com';

-- Çıkmak için
\q
ERROR:  syntax error at or near "su"
LINE 3: su
        ^
root@FiloApiAppArchitect:/home/root/FiloAPIapp# UPDATE users SET password_hash='$2b$10$GXMjN.oKgS3vhKqGvLqYqe5Ys5.FjQqZ9YhXqY3FmHh9qKtYxYvFG' WHERE email='alper.acar@architectaiagency.com';

-- Çıkmak için
\q
UPDATE: command not found
--: command not found
Command 'q' not found, but can be installed with:
snap install q
root@FiloApiAppArchitect:/home/root/FiloAPIapp# cd /home/root/FiloAPIapp

# Önce hash oluşturun
HASH=$(node -e "import('bcryptjs').then(b => b.hash('Acar', 10).then(h => console.log(h)))")

# Sonra güncelleyin
source .env
PGPASSWORD="$DB_PASS" psql -h localhost -U postgres -d filoki_db -c "UPDATE users SET password_hash='$HASH' WHERE email='alper.acar@architectaiagency.com';"

# PM2'yi yeniden başlatın
pm2 restart filoki-api

# Test edin
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"alper.acar@architectaiagency.com","password":"Acar"}'
Password for user postgres: 
UPDATE 1
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [filoki-api](ids: [ 0 ])
[PM2] [filoki-api](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ filoki-api         │ fork     │ 1    │ online    │ 0%       │ 4.1mb    │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
curl: (7) Failed to connect to localhost port 5000 after 0 ms: Could not connect to server
root@FiloApiAppArchitect:/home/root/FiloAPIapp# 